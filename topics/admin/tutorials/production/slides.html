<!DOCTYPE html>
<html>









  <head>
    <meta charset="utf-8">
    <title>Gearing towards production</title>
    
        <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', '' , 'auto');
    ga('send', 'pageview');
</script>

<script async defer data-domain="training.galaxyproject.org" src="https://plausible.galaxyproject.eu/js/plausible.js"></script>
    
    <link rel="stylesheet" href="/training-material/assets/css/slides.css">
    <script src="https://kit.fontawesome.com/67b3f98409.js" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon" />

    
    
    
    
    <meta name="description" content="Resources related to configuration and maintenance of Gal..." />
    <meta property="og:title" content="Galaxy Training: Gearing towards production" />
    <meta property="og:description" content="Resources related to configuration and maintenance of Gal..." />
    <meta property="og:image" content="/training-material/assets/images/GTNLogo1000.png" />
    <script type="application/ld+json">
      


{
  "@context": "http://schema.org",
  "@type": "Course",
  "accessMode": [
    "textual",
    "visual"
  ],
  "accessModeSufficient": [
    "textual",
    "visual"
  ],
  "accessibilityControl": [
    "fullKeyboardControl",
    "fullMouseControl"
  ],
  "accessibilityFeature": [
    "alternativeText",
    "tableOfContents"
  ],
  "accessibilitySummary": "Short descriptions are present but long descriptions will be needed for non-visual users",
  "audience": {
    "@type": "EducationalAudience",
    "educationalRole": "students"
  },
  "citation": {
    "@type": "CreativeWork",
    "name": "Community-Driven Data Analysis Training for Biology",
    "url": "https://doi.org/10.1016/j.cels.2018.05.012"
  },
  "copyrightHolder": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "discussionUrl": "https://gitter.im/Galaxy-Training-Network/Lobby",
  "headline": "Gearing towards production",
  "inLanguage": {
    "@type": "Language",
    "name": "English",
    "alternateName": "en"
  },
  "interactivityType": "mixed",
  "isAccessibleForFree": true,
  "license": "https://github.com/galaxyproject/training-material/blob/master/LICENSE.md",
  "producer": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "provider": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "sourceOrganization": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "isPartOf": {
    "@type": "CreativeWork",
    "name": "Galaxy Server administration",
    "description": "Resources related to configuration and maintenance of Galaxy servers",
    "url": "https://training.galaxyproject.org//training-material/topics/admin/"
  },
  "courseCode": "admin / production / slides",
  "learningResourceType": "slides",
  "name": "Slides for 'Gearing towards production' tutorial",
  "url": "https://training.galaxyproject.org//training-material/topics/admin/tutorials/production/slides.html",
  "description": "",
  "hasPart": [

  ],
  "author": [
    {
      "@type": "Person",
      "name": "Nate Coraor"
    },
    {
      "@type": "Person",
      "name": "Daniel Blankenberg"
    },
    {
      "@type": "Person",
      "name": "Abdulrahman Azab"
    },
    {
      "@type": "Person",
      "name": "Martin Čech"
    }
  ],
  "contributor": [
    {
      "@type": "Person",
      "name": "Nate Coraor"
    },
    {
      "@type": "Person",
      "name": "Daniel Blankenberg"
    },
    {
      "@type": "Person",
      "name": "Abdulrahman Azab"
    },
    {
      "@type": "Person",
      "name": "Martin Čech"
    }
  ],
  "about": [
    {
      "@type": "CreativeWork",
      "name": "Galaxy Server administration",
      "description": "Resources related to configuration and maintenance of Galaxy servers",
      "url": "https://training.galaxyproject.org//training-material/topics/admin/"
    }
  ]
}
    </script>
    <script type="text/javascript" src="/training-material/assets/js/jquery.slim.min.js"></script>
  </head>
  <body>
    <textarea id="source">
name: inverse
layout: true
class: center, middle, inverse

<div class="my-header"><span>
<a href="/training-material/topics/admin" title="Return to topic page" ><i class="fa fa-level-up" aria-hidden="true"></i></a>

<a class="nav-link" href="https://github.com/galaxyproject/training-material/edit/master/topics/admin/tutorials/production/slides.html"><i class="fa fa-pencil" aria-hidden="true"></i></a>

</span></div>

<div class="my-footer"><span>

<img src="/training-material/assets/images/GTN-60px.png" alt="Galaxy Training Network" style="height: 40px;"/>

</span></div>

---

# Gearing towards production



.footnote[Tip: press `P` to view the presenter notes]

???
Presenter notes contain extra information which might be useful if you
intend to use these slides for teaching.

Press `P` again to switch presenter notes off

Press `C` to create a new window where the same presentation will be displayed.
This window is linked to the main window. Changing slides on one will cause the
slide to change on the other. Useful when presenting.

---

# Production server

* Used by multiple people
* Designed to be resilient, scalable
* Designed to be easily managed

---

# Configuration Options

---
class: reduce90

# Configuring uWSGI

Important options in the `uwsgi` section

option | description
---- | ----
`http` | port and IP on which to listen for HTTP requests, `:8080` for port `8080` on all network interfaces. **For a production server, you should use `socket:` and a proxy server**.
`socket` | port and IP on which to listen for uWSGI protocol requests, `127.0.0.1:8000` for port `8000` on localhost.
`processes` | number of uWSGI *web workers*.
`threads` | number of threads for each web worker.
`offload-threads` | number of threads for internal routing requests, 1-2 is sufficient.
`master` | use uWSGI master process manager, defaults to `false` for dev compatibility but should be `true` in production.
`mule-reload-mercy` | time to gracefully wait for mule shutdown, set &gt; `monitor_thread_join_timeout` galaxy option.

.footnote[modifying `galaxy.yml`]

---
# Basics for the Galaxy App

Important options in the `galaxy` section

option | description
---- | ----
`database_connection` | SQLAlchemy connection string for database.
`tool_config_file` | List of tool panel config files to load.
`tool_dependency_dir` | folder where tool dependencies (Conda packages) are installed.

.left[Make sure dev settings `debug` and `use_interactive` are disabled.]

.footnote[modifying `galaxy.yml`]

---
# Authentication Options

option | description
---- | ----
`require_login` | Force everyone to log in (disable anonymous access).
`allow_user_creation` | Allow unregistered users to create new accounts (otherwise, they will have to be created by an admin).
`allow_user_deletion` | Allow administrators to delete accounts.
`allow_user_impersonation` | Allow administrators to log in as other users (useful for debugging/support).

.footnote[modifying `galaxy.yml`]

---
# Securing your Object IDs

* User facing object IDs
  * Galaxy uses the Blowfish cipher to obscure integer IDs.
  * Prevents guessing the hashes for various Galaxy objects.
  * `id_secret` is used as the Blowfish key.
  * Changing the default `id_secret` is a must.
  * Changing `id_secret` will change &amp; invalidate existing URLs (e.g. datasets, histories, workflows, etc).

.footnote[modifying `galaxy.yml`]

---
# Customizing your &quot;Brand&quot;

option | description
---- | ----
`brand` | appends &quot;/{brand}&quot; to the &quot;Galaxy&quot; text in the masthead.
`logo_url` | URL linked by the &quot;Galaxy/brand&quot; text.
`helpsite_url` | URL linked by the &quot;Galaxy Help&quot; link in the &quot;Help&quot; menu.
`wiki_url` | URL linked by the &quot;Wiki&quot; link in the &quot;Help&quot; menu.
`support_url` | URL linked by the &quot;Support&quot; link in the &quot;Help&quot; menu.
`citation_url` | URL linked by the &quot;How to Cite Galaxy&quot; link in the &quot;Help&quot; menu.
`search_url` | URL linked by the &quot;Search&quot; link in the &quot;Help&quot; menu.
`mailing_lists_url` | URL linked by the &quot;Mailing Lists&quot; link in the &quot;Help&quot; menu.
`screencasts_url` | URL linked by the &quot;Videos&quot; link in the &quot;Help&quot; menu.
`terms_url` | URL linked by the &quot;Terms and Conditions&quot; link on the registration form.
`qa_url` | URL linked by the &quot;Galaxy Q&amp;A&quot; link in the &quot;Help&quot; menu.

.footnote[modifying `galaxy.yml`]

---
# Adding a Notice Banner

option | sample value
---- | ----
`message_box_visible` | `true`
`message_box_content` | `Downtime scheduled Sunday at Noon to one.`
`message_box_class` | `warning` (also: `error`, `info`)

.footnote[modifying `galaxy.yml`]

---
# Update the welcome page

Welcome page is `$GALAXY_ROOT/static/welcome.html` and is the first thing that
users see. It is a good idea to extend it with things like:
- Downtimes/Maintenance periods
- New tools
- Publications relating to your Galaxy

.left[No restarting is necessary.]

---
# Client Browser Security

option | description
---- | ----
`sanitize_all_html` | by default, Galaxy sanitizes all &quot;text/html&quot; tool outputs. Setting to false potentially exposes users to XSS attacks.
`sanitize_whitelist_file` | manually override html sanitization for listed tools. Can set in admin interface.
`serve_xss_vulnerable_mimetypes` | certain filetypes (e.g. SVG) can contain JS that is vulnerable to XSS (Cross-site scripting) and are served as &quot;plain/text&quot; by default.
`allowed_origin_hostnames` | Returns Access-Control-Allow-Origin response header that matches the Origin header of the request.

.footnote[modifying `galaxy.yml`]

---
# Debugging

These should never be enabled on a public site.

option | description
---- | ----
`debug` | enable debug options, preserves cluster job data on disk (but use `cleanup_job` for this).
`use_profile` | Python profiler on requests.
`use_printdebug` | Anything &quot;print&quot;ed within a Galaxy Web thread is exposed to user.
`use_interactive` | Enable live debugging in your browser.

.footnote[modifying `galaxy.yml`]

---
# Configuring FTP

option | description
---- | ----
`ftp_upload_dir` | Directory containing subdirectories matching users' identifier (defaults to e-mail).
`ftp_upload_site` | Hostname of your FTP server provided to users in the help text. Must set to enable FTP import.
`ftp_upload_dir_identifier` | User attribute for subdirectory naming. 'email' (${user.email}) is default, but 'id' or 'username' are also common.
`ftp_upload_dir_template` | Python string template used to determine a users FTP upload directory (${ftp_upload_dir}/${ftp_upload_dir_identifier}).
`ftp_upload_purge` | Delete files after FTP import (true).

.footnote[modifying `galaxy.yml`]

---
class: reduce90

# Configuring Data Library Path Uploads

Admin options

option | description
---- | ----
`library_import_dir` | Browse and upload files from configured directory.
`allow_path_paste` | Allow admins to paste any path to upload (e.g. `file://`), applies also to the general 'upload tool'.

User options

option | description
---- | ----
`user_library_import_dir` | Root directory containing sub-directories named by user emails. A nifty setup is that the value is the same as for `ftp_upload_dir` allowing users to upload files via FTP and then import them either in history or data library.
`user_library_import_dir_auto_creation` | Create user's folder upon login.
`user_library_import_symlink_whitelist` | Directories that users are allowed to symlink to.
`user_library_import_check_permissions` | If Galaxy usernames match system usernames enable this to use UNIX permissions.

.footnote[modifying `galaxy.yml`]

---
class: reduce90

# Configuring SMTP

SMTP server

option | description
---- | ----
`smtp_server` | host:port of SMTP server to use. Uses STARTTLS, but will fallback.
`smtp_username` | Username for SMTP server.
`smtp_password` | Password for SMTP server. STARTTLS recommended on SMTP server.
`smtp_ssl` | If SMTP server requires SSL from connection start, set to true.

Addresses

option | description
---- | ----
`error_email_to` | Address to send user error reports to.
`email_from` | Return address used in automatic user notifications. (`&lt;galaxy-no-reply@HOSTNAME&gt;`)
`mailing_join_addr` | Mailing list to subscribe users to during registration.

.footnote[modifying `galaxy.yml`]

---
class: left

# Configuring SMTP for Bug Reports

Install a mail tranfer agent (MTA):
* Here is a tutorial on how to [install Postfix MTA](https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-postfix-as-a-send-only-smtp-server-on-ubuntu-14-04)

Galaxy configuration:
1. Set `smtp_server: localhost:25`
2. Set `error_email_to: you@email.tld` (use your email)
3. Run a Galaxy tool that produces an error.
4. attempt to send a bug report

---
# galaxy.yml full options

a.k.a. Everything You Always Wanted to Know About `galaxy.yml`
* [config schema](https://github.com/galaxyproject/galaxy/blob/dev/lib/galaxy/webapps/galaxy/config_schema.yml)
* [config sample](https://github.com/galaxyproject/galaxy/blob/dev/lib/galaxy/config/sample/galaxy.yml.sample)
* [config docs](https://docs.galaxyproject.org/en/master/admin/config.html)


---

## Thank you!

This material is the result of a collaborative work. Thanks to the [Galaxy Training Network](https://wiki.galaxyproject.org/Teach/GTN) and all the contributors!


<div class="contributors-line">


<a href="/training-material/hall-of-fame/natefoo/" class="contributor-badge"><img src="https://avatars.githubusercontent.com/natefoo" alt="Nate Coraor">Nate Coraor</a>, <a href="/training-material/hall-of-fame/blankenberg/" class="contributor-badge"><img src="https://avatars.githubusercontent.com/blankenberg" alt="Daniel Blankenberg">Daniel Blankenberg</a>, <a href="/training-material/hall-of-fame/abdulrahmanazab/" class="contributor-badge"><img src="https://avatars.githubusercontent.com/abdulrahmanazab" alt="Abdulrahman Azab">Abdulrahman Azab</a>, <a href="/training-material/hall-of-fame/martenson/" class="contributor-badge"><img src="https://avatars.githubusercontent.com/martenson" alt="Martin Čech">Martin Čech</a>


</div>



<img src="/training-material/assets/images/GTN.png" alt="Galaxy Training Network" style="height: 100px;"/>


This material is licensed under the <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.


.footnote[Found a typo? Something is wrong in this tutorial? <br/>Edit it on [GitHub](https://github.com/galaxyproject/training-material/tree/master/topics/admin/tutorials/production/slides.html)]

    </textarea>
	<script src="/training-material/assets/js/remark-latest.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="/training-material/assets/js/theme.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/clipboard.min.js"></script>
    <script type="text/javascript">
      var slideshow = remark.create({navigation: {scroll: false,}});
      var hljs = remark.highlighter.engine;
      var snippets = document.querySelectorAll('code.remark-code');
        [].forEach.call(snippets,function(snippet){
          snippet.firstChild.insertAdjacentHTML('beforebegin','<button class="btn btn-light" data-clipboard-snippet><i class="fa fa-copy"></i>&nbsp;Copy</button>');
        });
      var clipboardSnippets=new ClipboardJS('[data-clipboard-snippet]',{
        target:function(trigger){return trigger.parentElement;
      }});
    </script>

    <script type="text/javascript">
        if(window.location.hostname === "galaxyproject.github.io") {
            // Redirect
            var redirect = "https://training.galaxyproject.org" + window.location.pathname + window.location.search;
            $('body').prepend("<div style='text-align: center'><strong>Note: </strong>This content has a new home at <a href=\"" + redirect + "\">" + redirect + "</a>, which you will be redirected to in 5 seconds.</div>");

            window.setTimeout(function(){
                window.location.href = redirect;
            }, 5000)

        }
    </script>

  </body>
</html>
